// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ↓↓↓ Bunları buraya ekliyorsun ↓↓↓

model User {
  id            String       @id @default(cuid())
  email         String       @unique
  username      String?      @unique
  name          String?
  password      String
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt

  accounts      Account[]
  sessions      Session[]
  userTenants   UserTenant[]

  @@map("User")
}

model Account {
  id                String   @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?  @db.Text
  access_token      String?  @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?  @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("Account")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("Session")
}

enum UserRole {
  admin
  member
}

model Tenant {
  id        String       @id @default(cuid())
  slug      String       @unique
  name      String
  ownerId   String?
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  Authors     Author[]
  Books       Book[]
  ToBuy       ToBuyBook[]
  userTenants UserTenant[]
}

model UserTenant {
  id        String   @id @default(cuid())
  userId    String
  tenantId  String
  role      UserRole @default(member)
  createdAt DateTime @default(now())

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([userId, tenantId])
  @@map("UserTenant")
}

model Author {
  id                String   @id @default(cuid())
  tenantId          String
  name              String
  nickname          String?
  origin            String?
  birthDate         String?
  deathDate         String?
  birthPlace        String?
  deathPlace        String?
  officialDuties    String?
  fiqhMadhhab       String?
  aqidahMadhhab     String?
  famousWorks       String?
  teachers          String?
  students          String?
  statusInTabakat   String?
  expertiseAreas    String?
  importantNotes    String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  Books             Book[]
  ToBuyBooks        ToBuyBook[]

  Tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model Book {
  id            String   @id @default(cuid())
  tenantId      String
  title         String
  authorId      String?
  genre         String?
  publisher     String?
  volumeCount   Int?
  library       String?
  shelf         String?
  number        String?
  note          String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  Author  Author? @relation(fields: [authorId], references: [id])
  Tenant  Tenant  @relation(fields: [tenantId], references: [id])
}

enum PurchaseStatus {
  pending
  ordered
  bought
  dismissed
}

model ToBuyBook {
  id            String         @id @default(cuid())
  tenantId      String
  title         String
  authorId      String?
  genre         String?
  publisher     String?
  volumeCount   Int?
  note          String?
  status        PurchaseStatus @default(pending)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  Author Author? @relation(fields: [authorId], references: [id])
  Tenant Tenant  @relation(fields: [tenantId], references: [id])
}
